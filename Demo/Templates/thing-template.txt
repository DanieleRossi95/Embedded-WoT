{% set ssid = template['ssid'] %}
{% set password = template['password'] %}
{% set protocolServer = 'http' %}
{% set protocolSocket = 'ws' %}
{% set portServer = template['portserver'] %}
{% set portSocket = template['portsocket'] %}
{% set ipServer = '192.168.1.5' %}
{% set thingName = td['title'].lower() %}
{% set urlServer = protocolServer + "://" + ipServer + ":" + portServer + "/" + thingName %}

{% macro defineVariable(type, name, value) -%}
    {%- if type == 'const char*' or type == 'String' %}
{{ type }} {{ name }} = "{{ value }}";
    {%- elif type == 'int' %}
{{ type }} {{ name }} = {{ value }};
    {%- endif %}    
{%- endmacro %}

{% macro updateEndPoints() -%}
{# EndPoint Thing #}
{% for item in td['forms'] if 'href' in item %}
    {% do item.update(href=urlServer + '/all/properties') %}
{% endfor %}    
{# EndPoint Properties #}
{%- endmacro %}

{{ updateEndPoints() }}

#include <ESP8266WebServer.h>
#include <WebSocketsServer.h>
#include <ArduinoJson.h>

{{ defineVariable('const char*', 'ssid', ssid) }}
{{ defineVariable('const char*', 'password', password) }}
{{ defineVariable('String', 'protocolServer', protocolServer) }}
{{ defineVariable('String', 'protocolSocket', protocolSocket) }}
{{ defineVariable('String', 'urlServer', '') }}
{{ defineVariable('String', 'urlSocket', '') }}
{{ defineVariable('int', 'portServer', portServer) }}
{{ defineVariable('int', 'portSocket', portSocket) }}

{{ defineVariable('String', 'thingName', thingName) }}
{{ defineVariable('String', 'td', '') }}

{#- String td = "{{ td | replace("'", '\\"') }}"; #}